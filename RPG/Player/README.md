# RPG玩家系统

这是一个完整的RPG玩家控制系统，包含移动、攻击、防御、弹反、跳跃和血量管理功能。

## 功能特性

### 基础移动

- **上下左右移动**：使用方向键或WASD键控制玩家移动
- **跳跃**：按空格键跳跃（可配置是否启用）
- **动画系统**：根据移动方向自动播放对应的行走和站立动画

### 战斗系统

- **攻击**：按J键或鼠标左键进行攻击
- **防御**：按住K键或鼠标右键进行防御，可减少50%伤害
- **弹反系统**：在敌人攻击前200-500毫秒内按防御键可触发弹反
  - 弹反成功时玩家不受任何伤害
  - 伤害会双倍反弹给攻击者
  - 弹反时间窗口可自定义配置

### 生命系统

- **默认3点血量**：玩家初始生命值为3点
- **血量显示**：血量条显示在玩家头顶
  - 满血时自动隐藏
  - 受伤后显示当前血量
- **无敌时间**：受伤后有1秒无敌时间，期间闪烁显示
- **生命升级**：支持后期升级最大生命值

### 动画系统

- **多方向动画**：支持前、后、左、右四个方向的动画
- **动作动画**：包含站立、行走、攻击、死亡动画
- **自动切换**：根据玩家状态和移动方向自动切换动画

## 文件结构

```
RPG/Player/
├── Player.tscn          # 玩家场景文件
├── Player.gd            # 玩家脚本
├── HealthBar.tscn       # 血量条UI组件
├── player.png           # 玩家精灵图
└── README.md           # 说明文档
```

## 设置说明

### 1. 输入映射设置

在Godot项目设置中添加以下输入映射：

- **attack**：攻击按键（建议：J键 + 鼠标左键）
- **defend**：防御按键（建议：K键 + 鼠标右键）

### 2. 可配置参数

在Player.gd脚本中可以调整以下参数：

```gdscript
# 生命系统
var max_health = 3              # 最大生命值
var move_speed = 200.0          # 移动速度
var jump_velocity = -400.0      # 跳跃速度
var can_jump = true             # 是否启用跳跃

# 战斗系统
var attack_damage = 1           # 攻击伤害
var parry_window_start = 200    # 弹反窗口开始时间(毫秒)
var parry_window_end = 500      # 弹反窗口结束时间(毫秒)
var invulnerability_duration = 1000  # 受伤后无敌时间(毫秒)
```

## 使用方法

### 1. 基本控制

- **移动**：方向键或WASD
- **跳跃**：空格键（如果启用）
- **攻击**：J键或鼠标左键
- **防御**：K键或鼠标右键

### 2. 弹反技巧

1. 观察敌人的攻击动作
2. 在敌人攻击即将命中前200-500毫秒内按下防御键
3. 成功弹反会完全免疫伤害并反弹双倍伤害

### 3. 脚本接口

```gdscript
# 造成伤害给玩家
player.take_damage(damage_amount, attacker_node)

# 治疗玩家
player.heal(heal_amount)

# 升级玩家最大生命值
player.upgrade_health(additional_health)
```

## 扩展功能

### 添加新动画

1. 在player.png中添加新的动画帧
2. 在Player.tscn的SpriteFrames中创建新动画
3. 在Player.gd的update_animation()函数中添加动画逻辑

### 添加技能系统

1. 在Player.gd中添加技能相关变量
2. 创建新的输入映射
3. 在_physics_process()中处理技能输入
4. 实现技能效果和冷却时间

### 添加装备系统

1. 创建装备数据结构
2. 修改攻击伤害和防御计算
3. 添加装备效果到战斗系统

## 注意事项

1. **物理层设置**：确保敌人和玩家在正确的物理层上，以便攻击检测正常工作
2. **动画资源**：确保player.png包含所有必要的动画帧
3. **输入映射**：记得在项目设置中添加attack和defend输入映射
4. **场景引用**：如果移动文件位置，需要更新场景中的资源路径

## 故障排除

### 常见问题

1. **攻击无效果**
   - 检查输入映射是否正确设置
   - 确认敌人有take_damage()方法

2. **动画不播放**
   - 检查SpriteFrames资源是否正确配置
   - 确认动画名称拼写正确

3. **弹反不工作**
   - 检查弹反时间窗口设置
   - 确认敌人攻击时调用了take_damage()方法

4. **血量条不显示**
   - 检查HealthBar.tscn是否正确引用
   - 确认血量条节点路径正确
